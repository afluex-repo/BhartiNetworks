@model BhartiNetwork.Models.Admin

@{
    ViewBag.Title = "PurchaseOrderForm";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-wrapper">
    @using (Html.BeginForm("PurchaseOrderForm", "Admin", FormMethod.Post, new { @id = "form1", enctype = "multipart/form-data" }))
    {
        @*<div class="row">*@
        <div class="col-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Purchase Order</h4>
                    <hr style="background-color:white" />
                    <p style="color:red;">
                        @TempData["PoForm"]
                    </p>

                    <div class="container">
                        <div class="row">
                            <div class="col-sm-6">
                                <label for="exampleInputEmail3">Vendor Name <span style="color: red">*</span></label>
                                @Html.DropDownListFor(m => m.PK_VendorId, new SelectList(ViewBag.ddlVendor, "Value", "Text"), new { @class = "form-control", @onchange = "return onchangeGetAddress();" })
                            </div>
                            <div class="col-sm-6">
                                <label for="exampleInputEmail3">To Address <span style="color: red">*</span></label>
                                @Html.TextAreaFor(m => m.Address, new { @class = "form-control", @placeholder = "To Address" })
                            </div>
                        </div>
                        <hr style="background-color:white" />
                        <div class="row">
                            <div class="col-sm-6">
                                <label for="exampleInputEmail3">Destination<span style="color: red">*</span></label>
                                @Html.TextBoxFor(m => m.Destination, new { @class = "form-control", @placeholder = "Destination" })
                            </div>
                            <div class="col-sm-3">
                                <label for="exampleInputEmail3">Type<span style="color: red">*</span></label><br />
                                <input type="radio" id="GST" name="Type" value="GST" />GST
                                <input type="radio" id="PAN" name="Type" value="PAN" />PAN
                            </div>

                            <div class="col-sm-3" style="display:none" id="GSTType">
                                <label for="exampleInputEmail3">GST Type<span style="color: red">*</span></label><br />
                                <input type="radio" id="Type" name="InterStatus" value="InterStatus" />Inter Status
                                <input type="radio" id="Type" name="InterStatus" value="IntraStatus" />Intra Status
                            </div>

                        </div>
                        @*<div class="row" style="display:none" id="demo">
                           
                        </div>*@
                        <div class="row" style="display:none" id="IGST">
                            <div class="col-sm-6">
                                <input type="radio" id="IGST" name="IGST" value="IGST" />IGST
                            </div>
                        </div>

                            <div class="row" style="display:none">
                                <div class="col-sm-6">
                                    <input type="radio" id="CGST" name="CGST" value="CGST" />CGST
                                    <input type="radio" id="CGST" name="CGST" value="SGST" />SGST
                                </div>
                            </div>
                            <hr style="background-color:white" />
                            <div class="row">
                                <div class="col-sm-12" style="overflow:scroll;overflow-y:hidden;overflow-x:scroll;">
                                    <table class="table  table-striped table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Item   <span style="color: red">*</span> </th>
                                                <th>Part No.<span style="color: red">*</span> </th>
                                                <th>Description <span style="color: red">*</span> </th>
                                                <th>HSN/SAC No.  <span style="color: red">*</span> </th>
                                                <th>CGST/SGST/ <span style="color: red">*</span> </th>
                                                <th>IGST Rate <span style="color: red">*</span> </th>
                                                <th>Unit <span style="color: red">*</span> </th>
                                                <th>Quantity <span style="color: red">*</span> </th>
                                                <th>Unit Price <span style="color: red">*</span> </th>
                                                <th>Taxable Total <span style="color: red">*</span> </th>
                                                <th>GST Value  <span style="color: red">*</span> </th>
                                                <th>Total  Value  <span style="color: red">*</span> </th>
                                                <th>Delivery Date <span style="color: red">*</span> </th>
                                                <th>REMARKS <span style="color: red">*</span> </th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="TextBoxContainer">
                                            <tr class="mycontainer" id="mainrow">
                                                <td>
                                                    @Html.TextBoxFor(m => m.Item, new { @class = "Item form-control", @Placeholder = "Item" })

                                                </td>
                                                <td>
                                                    @Html.TextBoxFor(m => m.PartNo, new { @class = "PartNo form-control", @Placeholder = "Part No." })

                                                </td>

                                                <td>
                                                    @Html.TextBoxFor(m => m.Description, new { @class = "Description form-control", @Placeholder = "Description" })

                                                </td>

                                                <td>
                                                    @Html.TextBoxFor(m => m.HSNSACNo, new { @class = "HSNSACNo form-control", @Placeholder = "HSN/SAC No" })

                                                </td>
                                                <td>
                                                    @Html.TextBoxFor(m => m.CGSTSGST, new { @class = "CGSTSGST form-control", @Placeholder = "CGST/SGST/" })

                                                </td>
                                                <td>
                                                    @Html.TextBoxFor(m => m.IGSTRate, new { @class = "IGSTRate form-control", @Placeholder = "IGST Rate" })

                                                </td>
                                                <td>
                                                    @Html.TextBoxFor(m => m.Unit, new { @class = "Unit form-control", @Placeholder = "Unit" })

                                                </td>
                                                <td>
                                                    @Html.TextBoxFor(m => m.Quantity, new { @class = "Quantity form-control", @Placeholder = "Quantity" })

                                                </td>
                                                <td>
                                                    @Html.TextBoxFor(m => m.UnitPrice, new { @class = "UnitPrice form-control", @Placeholder = "Unit Price" })

                                                </td>
                                                <td>
                                                    @Html.TextBoxFor(m => m.TaxableTotal, new { @class = "TaxableTotal form-control", @Placeholder = "Taxable Total" })

                                                </td>
                                                <td>
                                                    @Html.TextBoxFor(m => m.GSTValue, new { @class = "GSTValue form-control", @Placeholder = "GST Value" })

                                                </td>
                                                <td>
                                                    @Html.TextBoxFor(m => m.TotalValue, new { @class = "TotalValue form-control", @Placeholder = "Total  Value" })

                                                </td>
                                                <td>
                                                    @Html.TextBoxFor(m => m.DeliveryDate, new { @class = "DeliveryDate form-control", @Placeholder = "Delivery Date" })

                                                </td>

                                                <td>
                                                    @Html.TextBoxFor(m => m.Remark, new { @class = "Remark form-control", @Placeholder = "Remarks" })

                                                </td>
                                                <td>
                                                    <input type="button" id="add" data-toggle="tooltip" data-original-title="Add" value="Add" style="width:80px" class="btn btn-success" />
                                                </td>
                                            </tr>
                                    </table>
                                </div>
                            </div>

                            <div id="orderItems">
                                <table class="table  table-striped table-bordered" id="orderdetailsItems"></table>
                                <span id="orderItemError" style="color:red"></span>
                            </div>
                            <br />
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <input class="btn btn-info pull-left" type="submit" value="Save" id="btnsssubmit" name="Save" />
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>
    }
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
@*<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.0/themes/smoothness/jquery-ui.css">*@
@*<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">*@
@*<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />*@


<script>
    $("#GST").click(function () {
        $("#GSTType").show();
    });
    $("#PAN").click(function () {
        $("#GSTType").hide();
    });

</script>






<script type="text/javascript">
    $(document).ready(function () {
        $('#add').click(function () {
            debugger;
            var isAllValid = true;
            if (!($('#Item').val().trim() != '' && ($('#Item').val().trim()))) {
                $("#Item").addClass('errortext');
                $('#Item').focus();
                isAllValid = false;

            }
            else if (!($('#PartNo').val().trim() != '' && ($('#PartNo').val().trim()))) {
                $("#PartNo").addClass('errortext');
                $('#PartNo').focus();
                    isAllValid = false;
                }
            else if (!($('#Description').val().trim() != '' && ($('#Description').val().trim()))) {
                $("#Description").addClass('errortext');
                $('#Description').focus();
                isAllValid = false;
            }

            else if (!($('#HSNSACNo').val().trim() != '' && ($('#HSNSACNo').val().trim()))) {
                $("#HSNSACNo").addClass('errortext');
                $('#HSNSACNo').focus();
                isAllValid = false;
            }

            else if (!($('#CGSTSGST').val().trim() != '' && ($('#Description').val().trim()))) {
                $("#CGSTSGST").addClass('errortext');
                $('#CGSTSGST').focus();
                isAllValid = false;
            }

            else if (!($('#IGSTRate').val().trim() != '' && ($('#IGSTRate').val().trim()))) {
                $("#IGSTRate").addClass('errortext');
                $('#IGSTRate').focus();
                isAllValid = false;
            }

            else if (!($('#Unit').val().trim() != '' && ($('#Unit').val().trim()))) {
                $("#Unit").addClass('errortext');
                $('#Unit').focus();
                isAllValid = false;
            }

            else if (!($('#Quantity').val().trim() != '' && ($('#Quantity').val().trim()))) {
                $("#Quantity").addClass('errortext');
                $('#Quantity').focus();
                isAllValid = false;
            }
            else if (!($('#UnitPrice').val().trim() != '' && ($('#UnitPrice').val().trim()))) {
                $("#UnitPrice").addClass('errortext');
                $('#UnitPrice').focus();
                isAllValid = false;
            }
            else if (!($('#TaxableTotal').val().trim() != '' && ($('#TaxableTotal').val().trim()))) {
                $("#TaxableTotal").addClass('errortext');
                $('#TaxableTotal').focus();
                isAllValid = false;
            }
            else if (!($('#GSTValue').val().trim() != '' && ($('#GSTValue').val().trim()))) {
                $("#GSTValue").addClass('errortext');
                $('#GSTValue').focus();
                isAllValid = false;
            }
            else if (!($('#TotalValue').val().trim() != '' && ($('#TotalValue').val().trim()))) {
                $("#TotalValue").addClass('errortext');
                $('#TotalValue').focus();
                isAllValid = false;
            }
            else if (!($('#DeliveryDate').val().trim() != '' && ($('#DeliveryDate').val().trim()))) {
                $("#DeliveryDate").addClass('errortext');
                $('#DeliveryDate').focus();
                isAllValid = false;
            }
            else if (!($('#Remark').val().trim() != '' && ($('#Remark').val().trim()))) {
                $("#Remark").addClass('errortext');
                $('#Remark').focus();
                isAllValid = false;
            }


            debugger
            if (isAllValid) {
                var $newRow = $('#mainrow').clone().removeAttr('id');
                $('.Item', $newRow).prop('disabled', true).val($('#Item').val());
                $('.PartNo', $newRow).prop('disabled', true).val($('#PartNo').val());
                $('.Description', $newRow).prop('disabled', true).val($('#Description').val());

                $('.HSNSACNo', $newRow).prop('disabled', true).val($('#HSNSACNo').val());
                $('.CGSTSGST', $newRow).prop('disabled', true).val($('#CGSTSGST').val());
                $('.IGSTRate', $newRow).prop('disabled', true).val($('#IGSTRate').val());

                $('.Unit', $newRow).prop('disabled', true).val($('#Unit').val());
                $('.Quantity', $newRow).prop('disabled', true).val($('#Quantity').val());
                $('.UnitPrice', $newRow).prop('disabled', true).val($('#UnitPrice').val());

                $('.TaxableTotal', $newRow).prop('disabled', true).val($('#TaxableTotal').val());
                $('.GSTValue', $newRow).prop('disabled', true).val($('#GSTValue').val());
                $('.TotalValue', $newRow).prop('disabled', true).val($('#TotalValue').val());

                $('.DeliveryDate', $newRow).prop('disabled', true).val($('#DeliveryDate').val());
                $('.Remark', $newRow).prop('disabled', true).val($('#Remark').val());
             
                //Replace add button with remove button
                $('#add', $newRow).addClass('remove').val('Remove').removeClass('btn-success').addClass('btn-danger');
                //remove id attribute from new clone row
                $('#Item,#PartNo, #Description,#HSNSACNo,#CGSTSGST,#IGSTRate,#Unit,#Quantity,#UnitPrice,#TaxableTotal,#GSTValue,#TotalValue,#DeliveryDate,#Remark,#add', $newRow).removeAttr('id');
                $('span.error', $newRow).remove();
                //append clone row
                $('#orderdetailsItems').append($newRow);
                //clear select data
                $('#Item,#PartNo,#Description,#HSNSACNo,#CGSTSGST,#IGSTRate,#Unit,#Quantity,#UnitPrice,#TaxableTotal,#GSTValue,#TotalValue,#DeliveryDate,#Remark').val('');
                $('#orderItemError').empty();
            }
        })
        //remove button click event
        $('#orderdetailsItems').on('click', '.remove', function () {
            $(this).parents('tr').remove();
        });
        $('#btnsssubmit').click(function () {
            var isAllValid = true;
            if ($('#Name').val() == '-select-') {
                $("#Name").addClass('errortext');
                $('#Name').focus();
                //$("#divload").css({ 'display': 'none' });
                return false;
            }
            if ($('#Address').val() == '') {
                $("#Address").addClass('errortext');
                $('#Address').focus();
                //$("#divload").css({ 'display': 'none' });
                return false;
            }
            if ($('#Destination').val() == '') {
                $("#Destination").addClass('errortext');
                $('#Destination').focus();
                //$("#divload").css({ 'display': 'none' });
                return false;
            }
            if ($('#Type').val() == '') {
                $("#Type").addClass('errortext');
                $('#Type').focus();
                //$("#divload").css({ 'display': 'none' });
                return false;
            }
        
            $('#orderItemError').text('');
            var list = [];
            var errorItemCount = 0;
            $('#orderdetailsItems tr').each(function (index, ele) {
                if (
                    $('Name', this).val() == "") {
                    errorItemCount++;
                    $(this).addClass('error');
                } else {
                    var orderItem = {
                        CustomerName: (
                            $('.Item', this).val()),
                        PartNo: $('.PartNo', this).val(),
                        Description: $('.Description', this).val(),
                        HSNSACNo: $('.HSNSACNo', this).val(),
                        CGSTSGST: $('.CGSTSGST', this).val(),
                        IGSTRate: $('.IGSTRate', this).val(),
                        Unit: $('.Unit', this).val(),
                        Quantity: $('.Quantity', this).val(),
                        UnitPrice: $('.UnitPrice', this).val(),
                        TaxableTotal: $('.TaxableTotal', this).val(),
                        GSTValue: $('.GSTValue', this).val(),
                        TotalValue: $('.TotalValue', this).val(),
                        DeliveryDate: $('.DeliveryDate', this).val(),
                        Remark: $('.Remark', this).val(),
                    }
                    list.push(orderItem);
                }

            })
            console.log(list)
            if (errorItemCount > 0) {
                $('#orderItemError').text(errorItemCount + " invalid entry in order item list.");
                isAllValid = false;
            }

            if (list.length == 0) {
                $('#orderItemError').text('At least 1 row data required.');
                isAllValid = false;
                $("#divload").css({ 'display': 'none' });
                return false;
            }

            if (isAllValid) {
                debugger;
                var data = {
                    AddData: JSON.stringify(list),
                }
                debugger
                var formData = new FormData();
                //var files = $("#postedFile1").get(0).files;
                //formData.append("Image", files[0]);
                formData.append("Name", $('#Name').val());
                formData.append("AssociateID", $('#Address').val());
                formData.append("Pk_CategoryId", $('#Pk_CategoryId').val());
                formData.append("VisitDate", $('#VisitDate').val());
                formData.append("AssociateName", $('#AssociateName').val());
                formData.append("VehicleNumber", $('#VehicleNumber').val());
                formData.append("PickUpLocation", $('#PickUpLocation').val());
                formData.append("DropLocation", $('#DropLocation').val());
                formData.append("PickUpTime", $('#PickUpTime').val());
                formData.append("DropTime", $('#DropTime').val());
                formData.append("dataValue", JSON.stringify(data));
                console.log(formData);
                $.ajax({
                    type: 'POST',
                    url: "AddProfile",
                    data: formData,
                    cache: false,
                    contentType: false,
                    processData: false,
                    //url: 'save',
                    //Type: "POST",
                    //DataType: "JSON",
                    //data: { dataValue: JSON.stringify(data), SiteID: $("#SiteID").val(), AssociateID: $("#UserID").val(), Amount: $("#Amount").val(), VisiteDate: $("#VisitDate").val(), postedFile1: formData},

                    //contentType: 'application/json',
                    success: function (response) {
                        //alert(result);
                        if (response.status) {

                            // here we will clear the form
                            list = [];

                            //$('#ExpenseID,#ExpenseName,#TransactionID,#PaymentMode').val('0');
                            //$('#Check,#Amount,#Date,#Remarks').val('');
                            //$('#orderdetailsItems').empty();
                            //$('#orderdetailsItems').hide();
                        }
                        else {
                            alert('Error');
                        }
                        $('#submit').text('Save');
                    },
                    error: function (error) {
                        console.log(error);
                        $('#submit').text('Save');
                    }
                });
                $('#submit').text('Save');
            }
        });
    });

</script>
<script>
    function isNumberOrDecimal(evt) {
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode != 46 && charCode > 31
          && (charCode < 48 || charCode > 57))
            return false;

        return true;
    }
    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode;
        if (charCode != 46 && charCode > 31
          && (charCode < 48 || charCode > 57))
            return false;
        return true;
    }
</script>


<script>
    function onchangeGetAddress() {
        debugger;
        var PK_VendorId = $('#PK_VendorId').val();
        $.ajax({
            url: '/Admin/GetAddress', type: 'post', dataType: 'json',
            data: { 'PK_VendorId': PK_VendorId },
            success: function (data) {
                if (data.Result == "yes") {
                    $("#Address").val(data.Address);
                    $("#Address").removeClass('errortext');
                    $("#Name").removeClass('errortext');
                }
                else if (data.Result == "no") {
                    $("#Address").val('');
                    $("#Address").addClass('errortext');
                    $("#Name").addClass('errortext');
                    $('#Address').focus();
                }
            }
        });
    }
</script>

<style>
    .errortext {
        border: 1px solid red !important;
        background-color: #fff0f0 !important;
    }
</style>







































